!function(t){var e={};function n(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:s})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){var n,s,r;n=window,s=document,r={sender:"websocket",debug:!1,serverUri:null,conf:{meta:{}},stack:[],agent:{},lastPushStamp:0,lastPushIndex:0,reportInterval:5e3,handle:null,recordEventTypes:["mousemove","click","dblclick","keyup","scroll"],reportEventTypes:["mousemove","click","dblclick","keyup","scroll"],log:function(t){this.debug&&console.log(t)},showStack:function(){this.log(this.stack)},getStackMeta:function(){var t=this.conf.meta;return t.uri=n.location.href,t},getStackLast:function(){return this.stack[this.stack.length-1]},provision:function(){this.configure(),this.stack.push({stamp:this.getStamp(),event:"provision",meta:this.getStackMeta(),agent:this.agent}),this.log("_at provisioned")},configure:function(){this.conf.sender&&(this.sender=this.conf.sender),this.conf.serverUri&&(this.serverUri=this.conf.serverUri),this.conf.debug&&(this.debug=!!this.conf.debug),this.conf.reportInterval&&(this.reportInterval=parseInt(this.conf.reportInterval)),this.conf.subscribe&&(this.reportEventTypes=[],(this.conf.subscribe+"").split(",").forEach(function(t){t.trim()&&r.reportEventTypes.push(t.trim())})),this.log(this.conf)},init:function(){this.initAgent(),this.provision(),this.connect(),this.exposeUtil(),this.recordEventTypes.forEach(r.listenEvent),this.log("_at initialized")},initAgent:function(){if(void 0===n.platform)return!1;this.agent={ua:n.platform.ua,name:n.platform.name,version:n.platform.version,product:n.platform.product,manufacturer:n.platform.manufacturer,os:n.platform.os,layout:n.platform.layout,locale:navigator.language}},listenEvent:function(t){s.addEventListener(t,r.record)},record:function(t){var e={stamp:r.getStamp(),event:t.type,meta:r.getStackMeta(),properties:{}};switch(t.type){case"scroll":if(e.stamp-r.getStackLast().stamp<500)return;e.properties.pageYOffset=n.pageYOffset,e.properties.pageXOffset=n.pageXOffset;break;case"mousemove":if(e.stamp-r.getStackLast().stamp<1e3)return;e.properties.cursorX=t.pageX,e.properties.cursorY=t.pageY;break;case"keyup":e.properties.keyCode=t.keyCode;break;case"click":case"dblclick":e.properties.cursorX=t.pageX,e.properties.cursorY=t.pageY}r.stack.push(e)},connect:function(){if(!this.serverUri)return this.log("serverUri not configured!"),!1;if(this.handle)return this.handle;if("websocket"==this.sender)try{this.handle=new WebSocket(this.serverUri),this.handle.onopen=function(){r.send()}}catch(t){this.log("failed to connect to server")}else"xmlhttp"==this.sender?(this.handle=new XMLHttpRequest,this.handle.open("POST",this.serverUri,!0),this.handle.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.handle.onreadystatechange=function(){4==this.handle.readyState&&200==this.handle.status&&n.setTimeout(function(){r.send()},this.reportInterval)},r.send()):this.log("Unsupported sender: "+this.sender)},send:function(){if(this.handle){for(var t=[],e=this.lastPushIndex;e<this.stack.length;e++)("provision"==this.stack[e].event||this.reportEventTypes.indexOf(this.stack[e].event)>=0)&&t.push(this.stack[e]);this.lastPushIndex=e,this["send"+this.sender](JSON.stringify(t))}},sendwebsocket:function(t){if("websocket"!=this.sender)return!1;1===this.handle.readyState?(this.handle.send(t),n.setTimeout(function(){r.send()},this.reportInterval)):this.log(r.sender+" not ready")},sendxmlhttp:function(t){if("xmlhttp"!=this.sender)return!1;this.handle.send("&payload="+t)},getStamp:function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Date.now()},exposeUtil:function(){this.debug&&(n.atStack=r.showStack.bind(r))}},n.atProvision=r.provision.bind(r),n.at=function(){var t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);if(!t[0])return!1;"meta"==t[0]?r.conf.meta[t[1]]=t[2]||!0:r.conf[t[0]]=t[1]||!0},s.addEventListener("DOMContentLoaded",r.init.bind(r))}]);