!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e){var n,r,i;n=window,r=document,i={sender:"websocket",debug:!1,serverUri:null,conf:{},stack:[],agent:{},lastPushStamp:0,lastPushIndex:0,reportInterval:5e3,handle:null,log:function(t){this.debug&&console.log(t)},showStack:function(){this.log(this.stack)},getStackMeta:function(){let t=this.conf;return t.uri=n.location.href,t},getStackLast:function(){return this.stack[this.stack.length-1]},provision:function(){this.configure(),this.stack.push({stamp:this.getStamp(),event:"provision",meta:this.getStackMeta(),agent:this.agent}),this.log("_at provisioned")},configure:function(){this.conf.sender&&(this.sender=this.conf.sender),this.conf.serverUri&&(this.serverUri=this.conf.serverUri),this.conf.debug&&(this.debug=!!this.conf.debug),this.conf.reportInterval&&(this.reportInterval=parseInt(this.conf.reportInterval)),this.log(this.conf)},init:function(){this.initAgent(),this.provision(),this.connect(),this.exposeUtil(),["mousemove","click","dblclick","keyup","scroll"].forEach(i.listenEvent),this.log("_at initialized")},initAgent:function(){if(void 0===n.platform)return!1;this.agent={ua:n.platform.ua,name:n.platform.name,version:n.platform.version,product:n.platform.product,manufacturer:n.platform.manufacturer,os:n.platform.os,layout:n.platform.layout,locale:navigator.language}},connect:function(){if(!this.serverUri)return this.log("serverUri not configured!"),!1;if(this.handle)return this.handle;if("websocket"==this.sender)try{this.handle=new WebSocket(this.serverUri),this.handle.onopen=function(){i.send()}}catch(t){this.log("failed to connect to server")}},listenEvent:function(t){r.addEventListener(t,i.record)},record:function(t){let e={stamp:i.getStamp(),event:t.type,meta:i.getStackMeta(),properties:{}};switch(t.type){case"scroll":if(e.stamp-i.getStackLast().stamp<500)return;e.properties.pageYOffset=n.pageYOffset,e.properties.pageXOffset=n.pageXOffset;break;case"mousemove":if(e.stamp-i.getStackLast().stamp<1e3)return;e.properties.cursorX=t.pageX,e.properties.cursorY=t.pageY;break;case"keyup":e.properties.keyCode=t.keyCode;break;case"click":case"dblclick":e.properties.cursorX=t.pageX,e.properties.cursorY=t.pageY}i.stack.push(e)},send:function(t){if(this.handle){let t=[];for(var e=this.lastPushIndex;e<this.stack.length;e++)t.push(this.stack[e]);this.lastPushIndex=e,this.handle&&1===this.handle.readyState?(this.handle.send(JSON.stringify(t)),n.setTimeout(function(){i.send()},this.reportInterval)):this.log("websocket not ready")}},getStamp:function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Date.now()},exposeUtil:function(){this.debug&&(n.atStack=i.showStack.bind(i))}},n.atProvision=i.provision.bind(i),n.at=function(){let t=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);if(!t[0])return!1;i.conf[t[0]]=t[1]||!0},r.addEventListener("DOMContentLoaded",i.init.bind(i))}]);